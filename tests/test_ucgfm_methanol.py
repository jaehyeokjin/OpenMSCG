import pytest
from mscg.cli import cgfm



def test_slab(datafile):
    kwargs = {
        'top'     : datafile("methanol_ucg.data"),
        'traj'    : datafile("methanol_slab_cg.trr") + ",every=5",
        'names'   : 'MeOH,Near,Far',
        'cut'     : 8.0,
        'pair'    : ['Near,Near,min=3.0,resolution=0.05', 'Near,Far,min=3.0,resolution=0.05', 'Far,Far,min=3.0,resolution=0.05'],
        'ucg'     : 'replica=25,seed=1234',
        'ucg-wf'  : 'RLE,target=MeOH,high=Near,low=Far,rth=4.5,wth=3.5',
        'verbose' : 0,
        'save'    : 'return'
    }
    
    coeffs = cgfm.main(**kwargs)
    
    benchmark = [0.6065089777182445, 0.5667508987085629, 0.49521919410304216, 0.4829270513074474, 0.35643117015006165, 0.2685852052052393, 0.20937564628878552, 0.13979314590214595, 0.10674958998546057, 0.06280477688492322, 0.04969100082856342, 0.007230278101288324, -0.006798344275246185, -0.027383917552002934, -0.03644663582880186, -0.03777509677731304, -0.03190787205984839, -0.013296535629820654, 0.009616370645681414, 0.04410637263305794, 0.07286646504023132, 0.07657454639232672, 0.07956363803236664, 0.0872901217753398, 0.07328314301084535, 0.06635846247821325, 0.0613453413738087, 0.05015520429826748, 0.041951867951461566, 0.041429261148699076, 0.022005275921127332, 0.036490314201602175, 0.013109696060014341, 0.023194184479393795, 0.01126555007276354, 0.00938673423171372, 0.007897621516873643, 0.0033102596740426796, -0.0007955471443747826, -0.0035463445075295417, 0.003510744925769396, -0.018691058247811247, 0.001761919949478068, -0.013493618295819267, -0.010492137375034459, -0.009317970107737977]
    
    print("")
    
    for i in range(40):
        diff = (coeffs[i] - benchmark[i]) / benchmark[i]
        print("X=%3d, Y0=%10.3e, Y=%10.3e, dY/Y0=%5.2f%%" %(i+1, benchmark[i], coeffs[i], diff))
        
        if abs(benchmark[i])>0.05:
            assert abs(diff)<0.1
        
        
        
