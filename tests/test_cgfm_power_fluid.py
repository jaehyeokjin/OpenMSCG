import pytest
from mscg.cli import cgfm

def test(datafile):
    
    coeffs = cgfm.main(
        top     = datafile("unary_lj_fluid.top"),
        traj    = datafile("power_fluid.lammpstrj"),
        cut     = 10.0,
        pair    = ['model=BSpline type=1,1 min=3.0 resolution=0.25'],
        verbose = 0,
        save    = 'return'
    )
    
    benchmark = [11.029063095948848, 7.933854859379417, 3.820657888030876, 2.3690804774177017, -2.266569139983775, -0.46504379977860444, 2.0198592620463693, 1.282760361156597, 0.3107048584010469, 0.006171946165051665, 0.066608674745064, 0.012701429762586557, -0.10469788395934264, -0.18102943997618257, -0.14086149132621223, -0.043983747294786484, 0.0462481852487155, 0.0829417953626726, 0.07180870275643433, 0.03726021181263895, 0.007814735878711647, -0.005457215623736281, -0.005497163987962011, -0.004627511543548703, -0.011856692913184967, -0.02640439795863543, -0.0372399125635939, -0.028721898222104678, 0.0038219850896717067, 0.03320542386940279, 0.025563698821050283, -0.00918649793376726, -0.03820847324007515]
    
    print(coeffs)
    print("")
        
    for i in range(10):
        diff = (coeffs[i] - benchmark[i]) / benchmark[i]
        print("X=%3d, Y0=%10.3e, Y=%10.3e, dY/Y0=%5.2f%%" %(i+1, benchmark[i], coeffs[i], diff*100))
        assert abs(diff)<0.01