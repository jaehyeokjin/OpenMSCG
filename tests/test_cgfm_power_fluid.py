import pytest
from mscg.cli import cgfm

def test(datafile, show):
    
    coeffs = cgfm.main(
        top     = datafile("unary_lj_fluid.top"),
        traj    = datafile("power_fluid.lammpstrj"),
        cut     = 10.0,
        pair    = ['model=BSpline,type=1:1,min=3.0,max=10.0,resolution=0.25'],
        verbose = 0,
        save    = 'return'
    )
    
    benchmark = [10.769391057594138, 7.991577602531137, 3.568026927135243, 2.341048980744951, -2.4441689724875886, -0.5427912967517727, 1.8954923569504896, 1.1988659751902535, 0.2156649924675209, -0.06896140261551498, -0.0020939135440192214, -0.04124665532309724, -0.14749077809777833, -0.2140464688527841, -0.16105267235871068, -0.054045171638779754, 0.0350728994118753, 0.07688249680799186, 0.07423269421651568, 0.03744148966984262, 0.009746174852954481, -0.006455264587705956, -0.004133273072976451, -0.005958571678106109, -0.012376529956999338, -0.026926027462692737, -0.037786206515540544, -0.030068847119819997, 0.005144335358752028, 0.029991993600432032, 0.027913183641654737, -0.009941917975863857, -0.038150878153637796]
    
    show("coeffs", coeffs)
    print("")
        
    for i in range(10):
        diff = (coeffs[i] - benchmark[i]) / benchmark[i]
        print("X=%3d, Y0=%10.3e, Y=%10.3e, dY/Y0=%5.2f%%" %(i+1, benchmark[i], coeffs[i], diff*100))
        assert abs(diff)<0.01