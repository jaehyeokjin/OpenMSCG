import pytest
from mscg.cli import cgfm



def test_1s(datafile):
    
    coeffs = cgfm.main(
        top     = datafile("methanol_1728.data"),
        traj    = datafile("methanol_1728.trr"),
        names   = 'MeOH',
        cut     = 8.0,
        pair    = ['MeOH,MeOH,min=2.8,resolution=0.2'],
        verbose = 0,
        save    = 'return'
    )
    
    benchmark = [26.504006866408147, 23.023498705800332, 13.832459732420526, 8.012967512697388, 2.142135601997141, 0.9112975172183377, -1.6103894386767066, 0.021304915210068172, 2.421755862614969, 0.7783777871799102, 0.7929550049523472, 0.2224134817839319, 0.2085670130871647, -0.04686067510437626, -0.02910158069503434, -0.04325828137323792, -0.02632146457284144, -0.06535724198909665, -0.10452404869758714, -0.04787469726449954, -0.002091985524115537, 0.09717041104252017, 0.06222057631427423, 0.10133048273088438, 0.04280128991205383, 0.0645362477047864, 0.019795428430796944, 0.04029186016110773, -0.002300055857588276, 0.01722288801869408, 0.009504856176482883]
    
    print("")
    
    for i in range(20):
        diff = (coeffs[i] - benchmark[i]) / benchmark[i]
        print("X=%3d, Y0=%10.3e, Y=%10.3e, dY/Y0=%5.2f%%" %(i+1, benchmark[i], coeffs[i], diff))
        assert abs(diff)<0.01



def test_2s(datafile):
    
    coeffs = cgfm.main(
        top     = datafile("methanol_1728_2s.data"),
        traj    = datafile("methanol_1728_2s.trr,frames=500"),
        names   = 'CH3,OH',
        cut     = 8.0,
        pair    = ['CH3,CH3,min=2.9', 'CH3,OH,min=2.8', 'OH,OH,min=2.5'],
        bond    = ['CH3,OH,min=1.35,max=1.65,resolution=0.01'],
        verbose = 0,
        save    = 'return'
    )
    
    benchmark = [21.00648112607364, 18.671201520732943, 15.129717891566848, 15.063845492139919, 10.839751965924703, 8.69453899544927, 6.101169147179543, 4.803159318955482, 3.627586098768499, 2.693527568636665, 1.9532870404098195, 1.3381865942395499, 0.9963827099296668, 0.5865565122552289, 0.4085009212855018, 0.247274634984386, 0.14142018788501798, 0.13098826021969315, 0.09007099322824685, 0.05647732944895756, 0.05944963363061824, -0.004654992986556801, 0.04525713729900744, -0.08858269006345398, 0.13055232178499784, -0.11929872683681875, 0.054110639553202174, -0.07306790499360621, 0.02604976464289444, -0.023847473299195922, -0.019928669636235522, -0.028737745212036047, -0.006077352031804184, -0.0457200639132099, 0.0014249366566247447, -0.034712791995887164, -0.010651285507830618, 0.016416718829355262, -0.01788822438452849, -0.007405117780695506, 0.005194053822482411, -0.013746509526926456, 0.0060260093778719504, -0.03850007265252679, 0.05638870269606731, -0.003060833428398205, -0.006380789875050703, 0.020559095784059216, -0.010015019769537154, 0.026625004354688286, 0.018778023327658714, -0.011713787810195279, 0.01042914739080917, 0.019749302595798556, -0.021452829359478454, 0.024431951737681156, 12.760732850052149, 11.440485124561778, 10.05681387599535, 7.438319138973306, 5.685496866316552, 3.7852182329599393, 2.3161748639748643, 1.4146505319465565, 0.6565198162671732, 0.23908108757957142, -0.153762798919611, -0.2840542198554431, -0.4001802676516109, -0.442450121281497, -0.40480813600147336, -0.39106220353758037, -0.2850733184698572, -0.24575819241388733, -0.2067348190197257, -0.12510342648421796, -0.08567490875444665, -0.12685507861040773, -0.14040362364281433, -0.10613800823532371, -0.1537423593487097, -0.14323396916668749, -0.17556110137483572, -0.11199119763517154, -0.1701201182405579, -0.08659491812587841, -0.174056645702413, -0.04350887482912277, -0.15294126067858868, -0.030242972361954674, -0.11327526531300576, -0.06351085891282167, -0.0586276033252077, -0.06367476636313495, -0.09607615983597821, -0.03145888755015343, -0.06613282606649004, -0.027375150704207304, -0.050571866312224434, -0.03394975521868556, -0.0200821389488184, -0.031294501635093085, 0.000178055757840061, -0.05154557191304231, 0.023769476385243564, -0.03420905864518968, -0.02172001487660639, -0.00498251315607217, -0.00177709361158631, -0.020160028601962022, -0.007850667478476634, 0.004937072810749365, -0.018415448571248626, 20.134668228450483, 16.65873734623493, 11.83159504211513, 5.663708056638283, 1.3540996518168626, -1.745652204670764, -2.971659672502893, -3.3552263190379263, -3.087662679026241, -2.4936123843826774, -1.44717575863102, -0.8377821381661211, -0.07146253739881545, 0.12321632006933847, 0.7004207184131019, 0.527813252860561, 0.7467118952535149, 0.7085249863466172, 0.6194756546486802, 0.7583310760263231, 0.6201458964762416, 0.5467126339299054, 0.3412784651327144, 0.26374197166035923, 0.13731728277583433, 0.14938007758800792, 0.12841652869456877, 0.05494559605237478, 0.15679063113562386, -0.0004981431256183988, 0.130483541774998, -0.04943811702272342, 0.09545439184467017, -0.08916013462077954, 0.07116351108400831, -0.09186199744171343, -0.0009595962965421549, -0.05292751847684085, -0.0395235951863558, -0.06095430797683291, -0.0010179774032715938, -0.07521336894892267, -0.0025137203797828346, -0.04373955630219807, -0.015713073210650113, -0.03145643361847368, -0.008066161258434724, 0.003987121769494519, -0.023919073187480575, 0.004827396670361296, -0.016766429952408343, -0.004072926331797248, 0.011386850787093217, -0.026775369822763198, 0.027190220302912387, -0.03411526312348571, -0.010873945837248543, -0.0027008525864571243, 0.035143972852558464, -0.023328007075736453, 483.53681157576426, -47.56804436795081, 93.52888633844083, 73.77042117555766, 72.73356699691224, 66.95140060785027, 61.080817381826996, 55.77623617528748, 49.1800308469026, 43.8913123643796, 37.67074356408805, 32.03809690535412, 25.879503852595988, 20.085079324059926, 14.151238630336104, 8.172330584629979, 2.2900684787219108, -3.6396686004937036, -9.60724155727899, -15.551860240257653, -21.550721384590567, -27.39614212424793, -33.38404604845501, -39.222971896929636, -45.533655666832026, -50.94833595000994, -57.26782279765853, -63.26702106656147, -68.95216142829857, -74.67869304816831, -77.69331592474528, -81.24864932818117, -83.70399663449449]
    
    print("")
    
    for i in range(20):
        diff = (coeffs[i] - benchmark[i]) / benchmark[i]
        print("X=%3d, Y0=%10.3e, Y=%10.3e, dY/Y0=%5.2f%%" %(i+1, benchmark[i], coeffs[i], diff))
        assert abs(diff)<0.01
