import pytest
from mscg.cli import cghenm
import numpy as np

def test_3b(datafile):
    
    z = cghenm.main(
        traj = [datafile('3b_cg.lammpstrj')],
        temp = 310.0,
        cut  = 30.0,
        save = 'return'
    )
    
    ref_r = np.array([15.93843 ,   11.384056,   23.743023])
    ref_k = np.array([ 9.53983091, 11.6026943 ,  1.52075795])
    
    assert(np.sum(np.square(z['R0'] - ref_r))<0.01)
    assert(np.sum(np.square(z['K'] - ref_k))<0.01)


def test_atp(datafile):
    
    z = cghenm.main(
        traj = [datafile('atp_cg.trr')],
        temp = 310.0,
        cut  = 30.0,
        save = 'return'
    )
    
    ref_r = np.array([23.16228 , 24.98624 , 16.206163, 15.114333, 20.91082 , 15.145039,
        23.575151, 12.331692, 21.02484 , 16.177881, 24.804657, 18.940573,
        17.129625, 24.991705, 27.551624, 13.40528 , 16.283337, 16.647808,
        24.545956, 18.94434 , 26.028318, 28.346552, 25.968239, 19.4783  ,
        22.32488 , 25.106247, 22.31456 , 29.042362, 22.74274 , 23.602198,
        15.848802, 28.936619])
    
    ref_k = np.array([
        4.19177445, 5.18374287, 5.40158474, 2.33123308, 0.10299758, 3.89129902,
        0.37284126, 0.6020139,  1.21578176, 3.02246663, 5.96649194, 2.18035348,
        3.44167371, 2.4691995,  1.75793019, 1.84167509, 0.71156849, 1.85872723,
        0.69672503, 1.41454783, 0.25832084, 0.39819058, 0.60182705, 1.04458916,
        0.25809652, 0.15366518, 0.53515295, 1.69647798, 0.0446659,  1.44930727,
        1.35599693, 0.86371369])
    
    assert(z['K'].shape[0] == 32)
    assert(np.sum(np.square(z['R0'] - ref_r))<0.01)
    assert(np.sum(np.square(z['K'] - ref_k))<0.01)
    